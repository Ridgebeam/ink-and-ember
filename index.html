<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ink & Ember Mercantile | Portal</title>
    <style>
        :root {
            --charcoal: #121212;
            --ember: #E25822;
            --ink: #050505;
            --parchment: #d4c39e;
            --gold: #c5a059;
            --text: #e0e0e0;
            --transition: 0.4s cubic-bezier(0.165, 0.84, 0.44, 1);
        }

        /* --- ALL ORIGINAL STYLES PRESERVED --- */
        * { box-sizing: border-box; }
        body { 
            background: var(--charcoal); 
            color: var(--text); 
            font-family: 'Segoe UI', serif; 
            margin: 0; 
            line-height: 1.6;
            transition: background var(--transition);
        }

        body.ledger-mode {
            background-color: #2c241e;
            background-image: url('https://www.transparenttextures.com/patterns/dark-leather.png');
        }
        body.ledger-mode .hero { background: var(--parchment); color: #2c241e; border-bottom: 5px solid var(--gold); }
        body.ledger-mode .card { background: #f4e8c1; color: #2c241e; border: 1px solid #bdae8e; }

        .hero {
            height: 30vh;
            display: flex; flex-direction: column; justify-content: center; align-items: center;
            background: linear-gradient(rgba(0,0,0,0.8), rgba(0,0,0,0.8)), url('https://images.unsplash.com/photo-1510519133417-2467bcaf9910?q=80&w=2070&auto=format&fit=crop');
            background-size: cover; background-position: center; border-bottom: 3px solid var(--ember); text-align: center;
        }

        .hero h1 { font-size: 3rem; margin: 0; color: var(--ember); text-transform: uppercase; letter-spacing: 5px; text-shadow: 2px 2px 10px rgba(0,0,0,0.5); }

        .main-grid {
            max-width: 1200px; margin: -40px auto 50px;
            display: grid; grid-template-columns: 280px 1fr; gap: 2rem; padding: 0 1rem;
        }

        .card {
            background: var(--ink); padding: 1.5rem; border-radius: 4px;
            border-top: 3px solid var(--ember); box-shadow: 0 15px 35px rgba(0,0,0,0.5); margin-bottom: 1.5rem;
        }

        .module-nav { list-style: none; padding: 0; }
        .module-nav li { 
            padding: 0.8rem; margin-bottom: 0.4rem; background: #1a1a1a; cursor: pointer; 
            border-left: 0px solid var(--ember); transition: var(--transition);
            display: block; color: inherit; text-decoration: none;
        }
        .module-nav li:hover, .module-nav li.active { border-left: 5px solid var(--ember); background: #252525; }
        
        .archive-link { border: 1px solid var(--gold) !important; color: var(--gold) !important; font-weight: bold; }

        .input-group { margin-bottom: 1rem; }
        label { display: block; font-size: 0.75rem; text-transform: uppercase; color: var(--gold); margin-bottom: 0.3rem; }
        input, select, textarea { 
            width: 100%; padding: 0.7rem; background: #1a1a1a; border: 1px solid #333; color: white; border-radius: 4px;
        }

        #discord-preview {
            background: #0c0c0c; border: 1px solid #333; padding: 1rem;
            font-family: 'Consolas', monospace; white-space: pre-wrap;
            color: #d1d1d1; font-size: 0.85rem; margin-top: 1rem; border-radius: 4px;
        }

        .btn-flex { display: flex; gap: 10px; margin-top: 0.5rem; }
        .copy-btn {
            background: #333; color: white; border: none; padding: 0.8rem;
            flex: 1; font-weight: bold; cursor: pointer; text-transform: uppercase; border-radius: 4px;
        }
        .dispatch-btn {
            background: #5865F2; color: white; border: none; padding: 0.8rem;
            flex: 2; font-weight: bold; cursor: pointer; text-transform: uppercase; border-radius: 4px;
        }
        .copy-btn:hover, .dispatch-btn:hover { filter: brightness(1.2); }

        .theme-toggle { position: absolute; top: 15px; right: 15px; background: transparent; border: 1px solid var(--gold); color: var(--gold); padding: 5px 10px; cursor: pointer; border-radius: 4px; }

        .ledger-list { max-height: 300px; overflow-y: auto; font-size: 0.9rem; }
        .ledger-item { display: flex; justify-content: space-between; padding: 0.5rem; border-bottom: 1px solid #222; }
        
        .res-list { list-style: none; padding: 0; margin: 0; }
        .res-list li { font-size: 0.85rem; margin-bottom: 8px; border-bottom: 1px solid #222; padding-bottom: 4px; }
        .res-list a { color: var(--text); text-decoration: none; transition: 0.2s; }
    </style>
</head>
<body>

    <button class="theme-toggle" onclick="document.body.classList.toggle('ledger-mode')">Toggle Reader Mode</button>

    <header class="hero">
        <h1>Ink & Ember</h1>
        <p>Merchant Mercantile Portal</p>
    </header>

    <main class="main-grid">
        <aside>
            <div class="card">
                <ul class="module-nav">
                    <li id="nav-bulletin" class="active" onclick="showModule('bulletin')">üì¢ The Bulletin</li>
                    <li id="nav-ledger" onclick="showModule('ledger')">üñãÔ∏è The Ledger (Roster)</li>
                    <li id="nav-contract" onclick="showModule('contract')">üìú Trade Contracts</li>
                    <li id="nav-storefront" onclick="showModule('storefront')">üè™ Storefront</li>
                    <li id="nav-orders" onclick="showModule('orders')">üì¶ Orders</li>
                    <li id="nav-rp-info" onclick="showModule('rp-info')">üí° RP Info</li>
                    <li id="nav-off-screen" onclick="showModule('off-screen')">üïØÔ∏è Off-Screen RP</li>
                    <li id="nav-settings" onclick="showModule('settings')" style="border-top: 1px solid #333; margin-top: 10px; color: var(--gold)">‚öôÔ∏è Connection Settings</li>
                    <a href="https://ridgebeam.github.io/ink-and-ember/archive" target="_blank" style="text-decoration: none;">
                        <li class="archive-link">üìö Scholar's Archive ‚Üó</li>
                    </a>
                </ul>
            </div>
            
            <div class="card">
                <h4 style="color: var(--gold); margin-top: 0; font-size: 0.9rem; border-bottom: 1px solid var(--ember); padding-bottom: 5px;">The Merchant's Kit</h4>
                <label>Recommended Plugins</label>
                <ul class="res-list">
                    <li><a href="https://www.lotrointerface.com/downloads/info361-BuffBars.html" target="_blank">üí™ BuffBars</a></li>
                    <li><a href="https://www.lotrointerface.com/downloads/info1085-PrimePlugin.html" target="_blank">üí∞ PrimePlugin</a></li>
                    <li><a href="https://www.lotrointerface.com/downloads/info532-MoorMap.html" target="_blank">üó∫Ô∏è MoorMap</a></li>
                </ul>
            </div>
        </aside>

        <section>
            <div class="card" id="active-module"></div>
            
            <div class="card" id="preview-section">
                <label>Discord Output Preview</label>
                <div id="discord-preview">Generating...</div>
                <div class="btn-flex">
                    <button class="copy-btn" onclick="copyDiscordCode()">Copy Raw ANSI</button>
                    <button class="dispatch-btn" onclick="dispatchToDiscord()">üöÄ Dispatch Rich Embed</button>
                </div>
            </div>
        </section>
    </main>

    <script>
        // --- DATA STATE (ALL ORIGINAL DATA PRESERVED) ---
        const initialLedger = [
            { name: "Oghuz", role: "Grandmaster of Trade" },
            { name: "Furkz", role: "Regional Director (Rohan)" },
            { name: "Zekiro", role: "Regional Director (Gondor)" },
            { name: "Nevard", role: "Head of Pipe-weed & Spices" },
            { name: "Tatiane", role: "Caravan Overseer" },
            { name: "Inbar", role: "Artisan Guild Liaison" },
            { name: "Audalyn", role: "Master Dyecrafter" },
            { name: "Chey", role: "Mistress of the Lodge" }
        ];

        let state = {
            currentModule: 'bulletin',
            ledger: JSON.parse(localStorage.getItem('ie_roster')) || initialLedger,
            webhook: localStorage.getItem('ie_webhook') || ''
        };

        function showModule(modId) {
            state.currentModule = modId;
            document.querySelectorAll('.module-nav li').forEach(li => li.classList.remove('active'));
            document.getElementById(`nav-${modId}`).classList.add('active');
            render();
        }

        function render() {
            const display = document.getElementById('active-module');
            const mod = state.currentModule;

            if (mod === 'settings') {
                display.innerHTML = `
                    <h2>Connection Settings</h2>
                    <div class="input-group">
                        <label>Discord Webhook URL</label>
                        <input type="password" id="webhook-url" value="${state.webhook}" placeholder="https://discord.com/api/webhooks/...">
                        <p style="font-size: 0.7rem; color: var(--gold);">Saved locally to your browser.</p>
                        <button class="copy-btn" style="background:var(--ember)" onclick="saveSettings()">Save Configuration</button>
                    </div>`;
            } else if (mod === 'bulletin') {
                display.innerHTML = `
                    <h2>The Bulletin Board</h2>
                    <div class="input-group"><label>Announcement Title</label><input type="text" id="bul-title" oninput="updateOutput()"></div>
                    <div class="input-group"><label>Message Content</label><textarea id="bul-msg" rows="4" oninput="updateOutput()"></textarea></div>
                    <div class="input-group"><label>Urgency</label><select id="bul-urg" onchange="updateOutput()"><option value="info">General Info</option><option value="event">Upcoming Event</option><option value="alert">Critical Update</option></select></div>`;
            } else if (mod === 'ledger') {
                display.innerHTML = `
                    <h2>Merchant Ledger</h2>
                    <input type="text" id="ledger-search" placeholder="Search roster..." oninput="renderLedgerList()" style="margin-bottom:10px;">
                    <div class="ledger-list" id="ledger-items"></div>
                    <hr style="border-color:#333">
                    <div class="input-group" style="display:flex; gap:5px;"><input type="text" id="add-name" placeholder="Name"><input type="text" id="add-role" placeholder="Role"><button class="copy-btn" style="width:auto; margin:0;" onclick="addToLedger()">Add</button></div>`;
                renderLedgerList();
            } else if (mod === 'contract') {
                display.innerHTML = `<h2>Trade Contract</h2><div class="input-group"><label>Merchant</label><input type="text" id="m-name" oninput="updateOutput()"></div><div class="input-group"><label>Manifest</label><textarea id="m-manifest" oninput="updateOutput()"></textarea></div>`;
            } else if (mod === 'storefront') {
                display.innerHTML = `<h2>Storefront</h2><div class="input-group"><label>Item</label><input type="text" id="st-item" oninput="updateOutput()"></div><div class="input-group"><label>Quality</label><select id="st-qual" onchange="updateOutput()"><option value="standard">Standard</option><option value="crit">Critical Success (Purple)</option></select></div><div class="input-group"><label>Price</label><input type="text" id="st-price" oninput="updateOutput()"></div>`;
            } else if (mod === 'orders') {
                display.innerHTML = `<h2>Orders</h2><input type="text" id="o-client" placeholder="Client" oninput="updateOutput()"><textarea id="o-details" oninput="updateOutput()"></textarea>`;
            } else if (mod === 'off-screen') {
                display.innerHTML = `
                    <h2>Off-Screen RP Narrative</h2>
                    <div class="input-group"><label>Scene Location</label><input type="text" id="os-loc" oninput="updateOutput()"></div>
                    <div class="input-group"><label>Character Action</label><textarea id="os-hook" rows="4" oninput="updateOutput()"></textarea></div>
                    <div class="input-group"><label>Atmosphere Tone</label><select id="os-tone" onchange="updateOutput()"><option value="neutral">Warm Amber</option><option value="serious">Dark Grey</option><option value="secret">Deep Blue</option></select></div>`;
            }
            updateOutput();
        }

        // --- ORIGINAL LEDGER LOGIC (PRESERVED) ---
        function renderLedgerList() {
            const search = document.getElementById('ledger-search')?.value.toLowerCase() || "";
            const list = document.getElementById('ledger-items');
            if (!list) return;
            const filtered = state.ledger.filter(m => m.name.toLowerCase().includes(search) || m.role.toLowerCase().includes(search));
            list.innerHTML = filtered.map((m, i) => `<div class="ledger-item"><span><strong>${m.name}</strong> - ${m.role}</span><button onclick="deleteMember(${i})" style="background:none; border:none; color:red; cursor:pointer;">√ó</button></div>`).join('');
        }
        function addToLedger() {
            const name = document.getElementById('add-name').value;
            const role = document.getElementById('add-role').value;
            if(name && role) { state.ledger.push({name, role}); localStorage.setItem('ie_roster', JSON.stringify(state.ledger)); render(); }
        }
        function deleteMember(i) { state.ledger.splice(i, 1); localStorage.setItem('ie_roster', JSON.stringify(state.ledger)); render(); }
        function saveSettings() {
            state.webhook = document.getElementById('webhook-url').value;
            localStorage.setItem('ie_webhook', state.webhook);
            alert("Webhook Saved!");
        }

        // --- UPDATED DISPATCH LOGIC (RICH EMBEDS) ---
        async function dispatchToDiscord() {
            if (!state.webhook) return alert("Please set a Webhook URL in Connection Settings!");

            const mod = state.currentModule;
            let embed = {
                color: 14833698, // #E25822
                timestamp: new Date().toISOString(),
                footer: { text: "Ink & Ember Mercantile Dispatch" },
                thumbnail: { url: "https://cdn-icons-png.flaticon.com/512/3063/3063822.png" }
            };

            if (mod === 'bulletin') {
                embed.title = `üì¢ Bulletin: ${getVal('bul-title')}`;
                embed.description = getVal('bul-msg');
                embed.fields = [{ name: "Priority", value: document.getElementById('bul-urg').value, inline: true }];
            } else if (mod === 'contract') {
                embed.title = "üìú New Trade Contract";
                embed.fields = [
                    { name: "Merchant", value: getVal('m-name'), inline: true },
                    { name: "Manifest", value: getVal('m-manifest') }
                ];
            } else if (mod === 'ledger') {
                embed.title = "üñãÔ∏è Company Ledger Update";
                embed.description = state.ledger.map(m => `**${m.name}** - ${m.role}`).join('\n');
            } else if (mod === 'off-screen') {
                embed.title = `üïØÔ∏è RP Scene: ${getVal('os-loc')}`;
                embed.description = getVal('os-hook');
                embed.color = 3447003; // Blue
            }

            try {
                const response = await fetch(state.webhook, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ embeds: [embed] })
                });
                if (response.ok) alert("Rich Embed Dispatched!");
                else alert("Failed to send. Check Webhook URL.");
            } catch (err) { console.error(err); alert("Network Error."); }
        }

        // --- ORIGINAL PREVIEW LOGIC (PRESERVED) ---
        function updateOutput() {
            let ansi = "";
            const mod = state.currentModule;
            if (mod === 'bulletin') {
                const colors = { info: " [1;34m", event: " [1;32m", alert: " [1;31m" };
                const c = colors[document.getElementById('bul-urg')?.value || 'info'];
                ansi = `\`\`\`ansi\n${c}‚îè‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îì [0m\n${c}‚îÉ   NEWS: ${getVal('bul-title').toUpperCase().padEnd(33)}‚îÉ [0m\n${c}‚îó‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îõ [0m\n\n${getVal('bul-msg')}\n\`\`\``;
            } else if (mod === 'ledger' || mod === 'rp-info') {
                ansi = `\`\`\`ansi\n [1;33müåø INK AND EMBER HIERARCHY [0m\n`;
                state.ledger.forEach(m => { ansi += ` [1;37m${m.name.padEnd(12)} [0m  [1;30m| [0m  [1;34m${m.role} [0m\n`; });
                ansi += `\`\`\``;
            } else if (mod === 'contract') {
                ansi = `\`\`\`ansi\n [1;33m[ TRADE CONTRACT ] [0m\n [1;34mMerchant: [0m ${getVal('m-name')}\n [1;32mManifest: [0m\n${getVal('m-manifest')}\n\`\`\``;
            }
            document.getElementById('discord-preview').innerText = ansi || "Module not previewable in ANSI mode.";
        }

        function getVal(id) { return document.getElementById(id)?.value || "---"; }
        function copyDiscordCode() { navigator.clipboard.writeText(document.getElementById('discord-preview').innerText); alert("ANSI Copied!"); }

        render();
        
        // --- SOUND ENGINE ---
let audioCtx = null;

function initAudioContext() {
    // Initializes the audio context only after a user gesture to bypass browser security
    if (!audioCtx) audioCtx = new (window.AudioContext || window.webkitAudioContext)();
    if (audioCtx.state === 'suspended') audioCtx.resume();
}

function playClickSound() {
    initAudioContext();
    // UPDATE THE URL BELOW TO CHANGE THE .WAV FILE
    const audio = new Audio('https://static.wixstatic.com/mp3/27bdae_d39df76a7044438fb650577244adfdfa.wav');
    audio.volume = 0.2;
    audio.play().catch(e => { console.log("Audio play blocked until user interaction."); });
}

// Global listener: plays sound whenever a button or navigation item is clicked
document.addEventListener('click', (e) => {
    if (e.target.tagName === 'BUTTON' || e.target.closest('li')) {
        playClickSound();
    }
});
    </script>
</body>
</html>
