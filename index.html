<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ink & Ember Mercantile | Portal</title>
    <style>
        :root {
            --charcoal: #121212;
            --ember: #E25822;
            --ink: #050505;
            --parchment: #d4c39e;
            --gold: #c5a059;
            --text: #e0e0e0;
            --transition: 0.4s cubic-bezier(0.165, 0.84, 0.44, 1);
        }

        * { box-sizing: border-box; }
        body { 
            background: var(--charcoal); 
            color: var(--text); 
            font-family: 'Segoe UI', serif; 
            margin: 0; 
            line-height: 1.6;
            transition: background var(--transition);
        }

        /* --- LEDGER MODE (Adaptive UI) --- */
        body.ledger-mode {
            background-color: #2c241e;
            background-image: url('https://www.transparenttextures.com/patterns/dark-leather.png');
        }
        body.ledger-mode .hero { background: var(--parchment); color: #2c241e; border-bottom: 5px solid var(--gold); }
        body.ledger-mode .card { background: #f4e8c1; color: #2c241e; border: 1px solid #bdae8e; }

        .hero {
            height: 25vh;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            background: linear-gradient(rgba(0,0,0,0.8), rgba(0,0,0,0.8)), url('https://images.unsplash.com/photo-1510519133417-2467bcaf9910?q=80&w=2070&auto=format&fit=crop');
            background-size: cover;
            background-position: center;
            border-bottom: 3px solid var(--ember);
            text-align: center;
            padding: 20px;
        }

        .hero h1 { font-size: 2.5rem; margin: 0; color: var(--ember); text-transform: uppercase; letter-spacing: 5px; text-shadow: 2px 2px 10px rgba(0,0,0,0.5); }

        .main-grid {
            max-width: 1200px;
            margin: -30px auto 50px;
            display: grid;
            grid-template-columns: 280px 1fr;
            gap: 1.5rem;
            padding: 0 1rem;
        }

        /* --- MOBILE RESPONSIVENESS --- */
        @media (max-width: 850px) {
            .hero { height: 20vh; }
            .main-grid { grid-template-columns: 1fr; margin-top: 10px; }
            .module-nav { display: grid; grid-template-columns: 1fr 1fr; gap: 8px; }
            .module-nav li { margin-bottom: 0; font-size: 0.85rem; padding: 0.6rem; }
            .archive-link { grid-column: span 2; text-align: center; }
        }

        .card {
            background: var(--ink);
            padding: 1.5rem;
            border-radius: 4px;
            border-top: 3px solid var(--ember);
            box-shadow: 0 15px 35px rgba(0,0,0,0.5);
            margin-bottom: 1.5rem;
        }

        .module-nav { list-style: none; padding: 0; }
        .module-nav li { 
            padding: 0.8rem; margin-bottom: 0.4rem; background: #1a1a1a; cursor: pointer; 
            border-left: 0px solid var(--ember); transition: var(--transition);
            display: block; color: inherit; text-decoration: none;
        }
        .module-nav li:hover, .module-nav li.active { border-left: 5px solid var(--ember); background: #252525; }
        
        .archive-link { border: 1px solid var(--gold) !important; color: var(--gold) !important; font-weight: bold; }

        .input-group { margin-bottom: 1rem; }
        label { display: block; font-size: 0.75rem; text-transform: uppercase; color: var(--gold); margin-bottom: 0.3rem; }
        input, select, textarea { 
            width: 100%; padding: 0.7rem; background: #1a1a1a; border: 1px solid #333; color: white; border-radius: 4px; font-size: 1rem;
        }

        #discord-preview {
            background: #0c0c0c; border: 1px solid #333; padding: 1rem;
            font-family: 'Consolas', monospace; white-space: pre; 
            overflow-x: auto; color: #d1d1d1; font-size: 0.85rem; margin-top: 1rem; border-radius: 4px;
        }

        .copy-btn {
            background: var(--ember); color: white; border: none; padding: 0.8rem;
            width: 100%; font-weight: bold; cursor: pointer; margin-top: 0.5rem; text-transform: uppercase; border-radius: 4px;
        }

        .theme-toggle { position: absolute; top: 15px; right: 15px; background: rgba(0,0,0,0.5); border: 1px solid var(--gold); color: var(--gold); padding: 5px 10px; cursor: pointer; border-radius: 4px; font-size: 0.75rem; z-index: 100; }

        .ledger-list { max-height: 300px; overflow-y: auto; font-size: 0.9rem; }
        .ledger-item { display: flex; justify-content: space-between; padding: 0.5rem; border-bottom: 1px solid #222; }
        
        .res-list { list-style: none; padding: 0; margin: 0; }
        .res-list li { font-size: 0.85rem; margin-bottom: 8px; border-bottom: 1px solid #222; padding-bottom: 4px; }
        .res-list a { color: var(--text); text-decoration: none; }
    </style>
</head>
<body>

    <button class="theme-toggle" onclick="document.body.classList.toggle('ledger-mode')">Toggle Ledger Mode</button>

    <header class="hero">
        <h1>Ink & Ember</h1>
        <p>Merchant Mercantile Portal</p>
    </header>

    <main class="main-grid">
        <aside>
            <div class="card">
                <ul class="module-nav">
                    <li id="nav-bulletin" class="active" onclick="showModule('bulletin')">üì¢ The Bulletin</li>
                    <li id="nav-merchant-id" onclick="showModule('merchant-id')">üÜî Merchant ID Card</li>
                    <li id="nav-ledger" onclick="showModule('ledger')">üñãÔ∏è The Ledger (Roster)</li>
                    <li id="nav-contract" onclick="showModule('contract')">üìú Trade Contracts</li>
                    <li id="nav-storefront" onclick="showModule('storefront')">üè™ Storefront</li>
                    <li id="nav-orders" onclick="showModule('orders')">üì¶ Orders</li>
                    <li id="nav-rp-info" onclick="showModule('rp-info')">üí° RP Info</li>
                    <li id="nav-off-screen" onclick="showModule('off-screen')">üïØÔ∏è Off-Screen RP</li>
                    <a href="/archive" target="_blank" style="text-decoration: none;" class="archive-link">
                        <li>üìö Scholar's Archive ‚Üó</li>
                    </a>
                </ul>
            </div>
            
            <div class="card">
                <h4 style="color: var(--gold); margin-top: 0; font-size: 0.9rem; border-bottom: 1px solid var(--ember); padding-bottom: 5px;">The Merchant's Kit</h4>
                <ul class="res-list">
                    <li><a href="https://www.lotrointerface.com/downloads/info361-BuffBars.html" target="_blank">üí™ BuffBars</a></li>
                    <li><a href="https://www.lotrointerface.com/downloads/info1085-PrimePlugin.html" target="_blank">üí∞ PrimePlugin</a></li>
                    <li><a href="UI/Talathlan.layout">üé® Talathlan UI</a></li>
                </ul>
            </div>
        </aside>

        <section>
            <div class="card" id="active-module"></div>
            
            <div class="card" id="preview-section">
                <label>Discord Output Preview</label>
                <div id="discord-preview">Generating...</div>
                <button class="copy-btn" onclick="copyDiscordCode()">Copy to Clipboard</button>
            </div>
        </section>
    </main>

    <script>
        // --- SOUND ENGINE ---
        let audioCtx = null;
        function initAudioContext() {
            if (!audioCtx) audioCtx = new (window.AudioContext || window.webkitAudioContext)();
            if (audioCtx.state === 'suspended') audioCtx.resume();
        }
        function playClickSound() {
            initAudioContext();
            const audio = new Audio('https://static.wixstatic.com/mp3/27bdae_d39df76a7044438fb650577244adfdfa.wav');
            audio.volume = 0.2;
            audio.play().catch(e => {});
        }
        document.addEventListener('click', (e) => {
            if (e.target.tagName === 'BUTTON' || e.target.closest('li')) playClickSound();
        });

        // --- DATA STATE ---
        const initialLedger = [
            { name: "Oghuz", role: "Grandmaster of Trade" },
            { name: "Furkz", role: "Regional Director (Rohan)" },
            { name: "Zekiro", role: "Regional Director (Gondor)" },
            { name: "Nevard", role: "Head of Pipe-weed" }
        ];

        let state = {
            currentModule: 'bulletin',
            ledger: JSON.parse(localStorage.getItem('ie_roster')) || initialLedger
        };

        function showModule(modId) {
            state.currentModule = modId;
            document.querySelectorAll('.module-nav li').forEach(li => li.classList.remove('active'));
            document.getElementById(`nav-${modId}`).classList.add('active');
            render();
        }

        function render() {
            const display = document.getElementById('active-module');
            const mod = state.currentModule;

            if (mod === 'bulletin') {
                display.innerHTML = `<h2>The Bulletin Board</h2><div class="input-group"><label>Title</label><input type="text" id="bul-title" oninput="updateOutput()"></div><div class="input-group"><label>Message</label><textarea id="bul-msg" rows="4" oninput="updateOutput()"></textarea></div>`;
            } else if (mod === 'contract') {
                display.innerHTML = `
                    <h3>üìú Trade Contract Generator</h3>
                    <div class="input-group"><label>Merchant Name:</label><input type="text" id="merchant-name" placeholder="e.g., Master Cook Butterbur" oninput="updateOutput()"></div>
                    <div class="input-group"><label>Goods for Trade:</label><input type="text" id="trade-goods" placeholder="e.g., 20x Cram" oninput="updateOutput()"></div>
                    <div class="input-group">
                        <label>Urgency Level:</label>
                        <select id="urgency" onchange="updateOutput()">
                            <option value="Normal">Normal</option>
                            <option value="Urgent">Urgent (Red)</option>
                            <option value="Confidential">Confidential (Blue)</option>
                        </select>
                    </div>`;
            } else if (mod === 'merchant-id') {
                display.innerHTML = `<h2>Merchant ID</h2><div class="input-group"><label>Name</label><input type="text" id="id-name" oninput="updateOutput()"></div><div class="input-group"><label>Trade</label><input type="text" id="id-trade" oninput="updateOutput()"></div><div class="input-group"><label>Motto</label><input type="text" id="id-motto" oninput="updateOutput()"></div>`;
            } else if (mod === 'ledger') {
                display.innerHTML = `<h2>Merchant Ledger</h2><div class="ledger-list" id="ledger-items"></div><div class="input-group" style="display:flex; gap:5px; margin-top:10px;"><input type="text" id="add-name" placeholder="Name"><button class="copy-btn" style="width:auto; margin:0;" onclick="addToLedger()">Add</button></div>`;
                renderLedgerList();
            } else if (mod === 'storefront') {
                display.innerHTML = `<h2>Storefront</h2><div class="input-group"><label>Item</label><input type="text" id="st-item" oninput="updateOutput()"></div><div class="input-group"><label>Price</label><input type="text" id="st-price" oninput="updateOutput()"></div>`;
            } else if (mod === 'off-screen') {
                display.innerHTML = `<h2>Off-Screen RP</h2><div class="input-group"><label>Location</label><input type="text" id="os-loc" oninput="updateOutput()"></div><div class="input-group"><label>Action</label><textarea id="os-hook" rows="4" oninput="updateOutput()"></textarea></div>`;
            } else {
                display.innerHTML = `<h2>RP Info</h2><p>Data linked to current Ledger.</p>`;
            }
            updateOutput();
        }

        function renderLedgerList() {
            const list = document.getElementById('ledger-items');
            if (list) list.innerHTML = state.ledger.map((m, i) => `<div class="ledger-item"><span>${m.name}</span><button onclick="deleteMember(${i})" style="color:red; background:none; border:none;">√ó</button></div>`).join('');
        }

        function addToLedger() {
            const name = document.getElementById('add-name').value;
            if(name) { state.ledger.push({name, role: "Merchant"}); localStorage.setItem('ie_roster', JSON.stringify(state.ledger)); render(); }
        }

        function deleteMember(i) { state.ledger.splice(i, 1); localStorage.setItem('ie_roster', JSON.stringify(state.ledger)); render(); }

        function updateOutput() {
            let ansi = "";
            const mod = state.currentModule;
            const timestamp = new Date().toLocaleDateString();

            if (mod === 'contract') {
                const name = document.getElementById('merchant-name')?.value || "Unknown Merchant";
                const goods = document.getElementById('trade-goods')?.value || "None Listed";
                const urgency = document.getElementById('urgency')?.value;

                let colorCode = "\x1b[1;32m"; // Default Green
                if (urgency === "Urgent") colorCode = "\x1b[1;31m"; // Red
                if (urgency === "Confidential") colorCode = "\x1b[1;34m"; // Blue

                ansi = `\`\`\`ansi\n\x1b[1;33m--- INK & EMBER MERCANTILE: CONTRACT ---\x1b[0m\n\x1b[1;30mDate: ${timestamp}\x1b[0m\n\n${colorCode}Merchant:\x1b[0m ${name}\n${colorCode}Goods:\x1b[0m ${goods}\n${colorCode}Status:\x1b[0m ${urgency.toUpperCase()}\n\n\x1b[1;30m---------------------------------------\x1b[0m\n\`\`\``;
            } else if (mod === 'bulletin') {
                ansi = `\`\`\`ansi\n\x1b[1;34m‚îè‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îì\n‚îÉ NEWS: ${getVal('bul-title').toUpperCase().padEnd(23)}‚îÉ\n‚îó‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îõ\x1b[0m\n\n${getVal('bul-msg')}\n\`\`\``;
            } else if (mod === 'merchant-id') {
                ansi = `\`\`\`ansi\n\x1b[1;33m‚îè‚îÅ‚îÅ MERCHANT PASS ‚îÅ‚îÅ‚îì\x1b[0m\n\x1b[1;37mNAME:\x1b[0m ${getVal('id-name')}\n\x1b[1;34mTRADE:\x1b[0m ${getVal('id-trade')}\n\x1b[1;30m"${getVal('id-motto')}"\x1b[0m\n\`\`\``;
            } else if (mod === 'ledger' || mod === 'rp-info') {
                ansi = `\`\`\`ansi\n\x1b[1;33müñãÔ∏è THE COMPANY LEDGER\x1b[0m\n`;
                state.ledger.forEach(m => { ansi += `\x1b[1;37m${m.name.padEnd(14)}\x1b[0m \x1b[1;30m|\x1b[0m \x1b[1;34m${m.role}\x1b[0m\n`; });
                ansi += `\`\`\``;
            } else if (mod === 'storefront') {
                ansi = `\`\`\`ansi\n\x1b[1;36müè™ [ STOREFRONT ]\x1b[0m\n\x1b[1;37mItem:\x1b[0m ${getVal('st-item')}\n\x1b[1;33mPrice:\x1b[0m ${getVal('st-price')}\n\`\`\``;
            } else if (mod === 'off-screen') {
                ansi = `\`\`\`ansi\n\x1b[1;31müïØÔ∏è SCENE: ${getVal('os-loc').toUpperCase()}\x1b[0m\n\x1b[1;30m‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ\x1b[0m\n${getVal('os-hook')}\n\`\`\``;
            }

            document.getElementById('discord-preview').innerText = ansi;
        }

        function getVal(id) { return document.getElementById(id)?.value || "---"; }
        function copyDiscordCode() { navigator.clipboard.writeText(document.getElementById('discord-preview').innerText); alert("Copied to the Ledger (Clipboard)!"); }

        render();
    </script>
</body>

</html>



